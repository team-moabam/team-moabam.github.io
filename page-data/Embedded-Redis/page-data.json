{"componentChunkName":"component---src-templates-blog-template-js","path":"/Embedded-Redis/","result":{"data":{"cur":{"id":"3c9b6a3a-3099-5173-b4da-a26bc65d0b6d","html":"<p>안녕하세요. 현재 데브코스 4기로 활동 중인 모아밤팀 서버 개발자 홍혁준입니다. </p>\n<p>이번 포스팅에서 Embedded Redis에 대해 이야기를 풀어내 보려고 합니다. 감사합니다.</p>\n<hr>\n<h2 id=\"배경\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EA%B2%BD\" aria-label=\"배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배경</h2>\n<p>모아밤에서는 다음 요구사항을 위해 Redis 저장소를 활용하게 되었습니다.</p>\n<ul>\n<li>사용자는 다른 사용자에게 12시간 마다 1회 콕 알림을 보낼 수 있다.</li>\n<li>사용자는 자신이 속한 방의 인증타임에 알림이 울립니다.</li>\n</ul>\n<p>개인적으로 프로젝트 코드를 누군가가 클론했을 때, 즉시 로컬 환경에서는 개발 및 테스트를 시작할 수 있어야 한다고 생각합니다. 때문에, 테스트 할 수 있는 환경 구성이 필요하게 되었고 Embedded Redis을 적용하게 되었습니다. 사용할 기술은 다음과 같습니다.</p>\n<h4 id=\"spring-data-redis\" style=\"position:relative;\"><a href=\"#spring-data-redis\" aria-label=\"spring data redis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Data Redis</h4>\n<ul>\n<li>Redis를 마치 JPA Repository 이용하듯 인터페이스를 제공하는 Spring Module 입니다.</li>\n</ul>\n<h4 id=\"lettuce\" style=\"position:relative;\"><a href=\"#lettuce\" aria-label=\"lettuce permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lettuce</h4>\n<ul>\n<li>Redis Java Client로 현재 Spring Data Redis에서 공식 지원하는 클라이언트입니다.</li>\n<li>추가로 Jedis도 공식 지원하지만, 거의 업데이트 되지 않아서 Lettuce를 선택하게 되었습니다.</li>\n</ul>\n<h4 id=\"embedded-redis\" style=\"position:relative;\"><a href=\"#embedded-redis\" aria-label=\"embedded redis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Embedded Redis</h4>\n<ul>\n<li>H2와 같은 내장 Redis 데몬입니다. 즉, 로컬 환경 Redis를 실행하지 않아도 됩니다.</li>\n</ul>\n<hr>\n<h2 id=\"embedded-redis-적용하기\" style=\"position:relative;\"><a href=\"#embedded-redis-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"embedded redis 적용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Embedded Redis 적용하기</h2>\n<p><strong>1) build.gradle 설정</strong></p>\n<ul>\n<li>내장 Redis는 <a href=\"https://github.com/ozimov/embedded-redis\">it.ozimov</a> 외에도 <a href=\"https://github.com/kstyrc/embedded-redis\">kstyrc</a>가 있는데, kstyrc 오랫동안 업데이트가 없어서 kstyrc를 Fork해서 만들어진 it.ozimov 모듈을 사용하게 되었습니다.</li>\n<li>it.ozimov는 최신 버전으로 0.7.3이 있습니다. 다만, 해당 버전은 <a href=\"https://github.com/ozimov/embedded-redis/pull/18\">SLF4J가 여러번 바인딩되는 문제</a>가 발생해서 0.7.2 버전을 사용하게 되었습니다. 또 다른 해결 방법으로는 컴파일 시 SLF4J를 제외하는 방법이 있기도 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Redis\nimplementation 'org.springframework.boot:spring-boot-starter-data-redis'\n\n// Embedded-Redis\nimplementation group: 'it.ozimov', name: 'embedded-redis', version: '0.7.2'\n\n// 0.7.3 버전으로 할 때, SLF4J를 제외하는 방법\nimplementation ('it.ozimov:embedded-redis:0.7.3') { exclude group: \"org.slf4j\", module: \"slf4j-simple\" }</code></pre></div>\n<p><strong>2) Embedded Redis 시작 및 종료 설정</strong></p>\n<ul>\n<li>@Profile로 로컬 환경일 때만, 실행되도록 합니다.</li>\n<li>isRedisRunning() : </li>\n<li>findAvailablePort() : </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@Slf4j\n@Profile(\"local\")\n@Configuration\npublic class EmbeddedRedisConfig {\n\n    @Value(\"${spring.data.redis.port}\")\n    private int redisPort;\n\n    private RedisServer redisServer;\n\n    @PostConstruct\n    public void startRedis() throws IOException {\n        redisServer = new RedisServer(port);\n        redisServer.start();\n    }\n\n    @PreDestroy\n    public void stopRedis() {\n        redisServer.stop();\n    }\n}</code></pre></div>\n<p><strong>3) 통합 테스트 환경 구성</strong></p>\n<ul>\n<li>2단계까지만 설정 시, 여러 스프링 컨텍스트 실행할 때, EmbeddedReids 포트 충돌이 날 수 있습니다. 즉, 서로 다른 Property를 가진 테스트 코드가 있는 경우 충돌이 날 수 있습니다. 때문에, 아래와 같이 추가 설정이 필요합니다.</li>\n<li>startRedis()에서 메모리 할당을 명시했습니다. 이를 안할 시, <a href=\"https://github.com/kstyrc/embedded-redis/issues/77\">윈도우 환경에서는 문제</a>가 발생합니다.</li>\n<li>그 외 설명은 주석을 확인바랍니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// ...\npublic class EmbeddedRedisConfig {\n\n    // ...\n    \n    /**\n     * REDIS_SERVER_MAX_MEMORY : \"maxmemory 128M\"\n     */\n    @PostConstruct\n    public void startRedis() {\n        int port = isRedisRunning() ? findAvailablePort() : redisPort;\n        redisServer = RedisServer.builder()\n            .port(port)\n            .setting(REDIS_SERVER_MAX_MEMORY)\n            .build();\n\n        redisServer.start();\n    }\n\n    @PreDestroy\n    public void stopRedis() {\n        if (redisServer != null) {\n            redisServer.stop();\n        }\n    }\n\n    /**\n     * 현재 PC 서버에서 사용 가능한 포트 조회\n     */\n    public int findAvailablePort() {\n        for (int port = 10000; port &lt;= 65535; port++) {\n            Process process = executeGrepProcessCommand(port);\n\n            if (!isRunning(process)) {\n                return port;\n            }\n        }\n\n        throw new MoabamException(ErrorMessage.NOT_FOUND_AVAILABLE_PORT);\n    }\n\n    /**\n     * Embedded Redis가 현재 실행 중인지 확인\n     */\n    private boolean isRedisRunning() {\n        return isRunning(executeGrepProcessCommand(redisPort));\n    }\n\n    /**\n     * 해당 Port를 사용 중인 프로세스를 확인하는 sh 실행\n     */\n    private Process executeGrepProcessCommand(int redisPort) {\n        // netstat -nat : 시스템 네트워크 연결 상태 확인 명령어\n        // grep LISTEN : 'LISTEN'이 포함된 줄 확인 명령어\n        // grep %d : 앞서 주어진 출력 내용에서 포트번호가 포함된 줄 확인 명령어\n        String command = String.format(\"netstat -nat | grep LISTEN | grep %d\", redisPort);\n        \n        //  '/bin/sh'에서 '-c' 옵션과 함께 위에서 만든 command를 실행하는 명령을 배열 형태로 구성\n        String[] shell = {\"/bin/sh\", \"-c\", command};\n\n        try {\n            return Runtime.getRuntime().exec(shell);\n        } catch (IOException e) {\n            throw new MoabamException(e.getMessage());\n        }\n    }\n\n    /**\n     * 해당 Process가 현재 실행 중인지 확인\n     */\n    private boolean isRunning(Process process) {\n        String line;\n        StringBuilder pidInfo = new StringBuilder();\n\n        try (BufferedReader input = new BufferedReader(new InputStreamReader(process.getInputStream()))) {\n            while ((line = input.readLine()) != null) {\n                pidInfo.append(line);\n            }\n        } catch (Exception e) {\n            throw new MoabamException(ErrorMessage.ERROR_EXECUTING_EMBEDDED_REDIS);\n        }\n\n        return StringUtils.hasText(pidInfo.toString());\n    }\n}</code></pre></div>\n<hr>\n<h2 id=\"트러블-슈팅---m1-arm\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85---m1-arm\" aria-label=\"트러블 슈팅   m1 arm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트러블 슈팅 - M1 ARM</h2>\n<h3 id=\"문제-상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"문제 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 상황</h3>\n<p>테스트 환경에서 Ebmedded Redis가 동작하게 구성했는데, M1에서는 Database가 실행되지 않는 현상이 발생했습니다.</p>\n<hr>\n<h3 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인</h3>\n<p>Embedded Redis 라이브러리에서 mac_arm64 용 바이너리가 준비되어 있지 않고 소스 코드에도 MAC_OS_X_arm64가 없는 것이 원인입니다.</p>\n<hr>\n<h3 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h3>\n<p><strong>1) brew를 통한 wget 설치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install wget</code></pre></div>\n<p><strong>2) 소스 코드 다운로드 및 컴파일</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 소스 코드 다운로드\nwget https://download.redis.io/releases/redis-7.2.3.tar.gz\n\n// 압축 해제\ntar xzf redis-7.2.3.tar.gz \n\n// 디렉토리 이동\ncd redis-7.2.3\n\n// 파일 링크 및 설치 등\nmake</code></pre></div>\n<p><strong>3) 바이너리 파일 실행 여부 확인</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src/redis-server</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQoz52S2Y6DMAxFwy52EAjB/3+oR8fqTVPaGanzcOPg2Ce2Sdj33aZpsnmebVkWt+M4RjsMg63ral3X+R7hb9vWY8itqsqyLLOiKCyEEFjcUZalHz4OovhumsYt57qormsXuTFeIILZE5DnuSfiJwgfAHzY8zyNzgBTOfERKEAqVQQQkQRg27bYNi1j005cqk7JalkVcgGJx3HYdV3uf4PcgUpEukDQ+zwZC3Evc0uVJqdVCpbOhz/a932c3UeoQAIzU0G1/7PFu35rNR3DV0AW/dm0Kj2jL2HPh52C/1FV1A8+beV7CWkQKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis1.png\"\n        title=\"redis1.png\"\n        src=\"/static/f86e9de351ba312b8fc358dfea5e3de1/37523/redis1.png\"\n        srcset=\"/static/f86e9de351ba312b8fc358dfea5e3de1/e9ff0/redis1.png 180w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/f21e7/redis1.png 360w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/37523/redis1.png 720w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/302a4/redis1.png 1080w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/4ad3a/redis1.png 1152w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4) 바이너리 파일을 프로젝트에 추가</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABo0lEQVQoz5WS227TQBCG/SZcIJrY6z043vjYJMaJm6QJhcQiQbxBaRFC4gKJCx79Q17jCNobuPj0787ujHZnfi+Qho5yXtNs9ti05NVY4IfaxQf9V7whSaiIJL9mUTdUyxukif+r2HDX+zOYXb+mbnZsd3eu4Fgo/LC//Bzz1/ryQj9U+EIipMLEKfliy/5tS5ykhMoQatOr0k6ljpwKt+9jQmpXww8lXqATgqgkMAUiyvHtmqRqWW4O2KJhki+Zlo3D5ivi30yypTuzZYNJKnxTuDpemB9Rq6/I+gG9+sJs/8j2/I31x5805x9U7XdGi3vGHdU9/uITonpA1o9P+OzwAj0lMP0LO2RcUlYb5ss3rG5bVusD76ojp+bMoX7Ptr7FZnPGOkdExSVvoO9h2P+/60MgFUleMq9qbrY7imJGOcmY2YIizkitxRjNOAj7vg2EQw+fWSAispnz5GZ3R6AjrkLJSClGUjHqptoNwkQEKnIqdHSZtPfUR50fX7y84tieaD+cEKliUibEsykms5jcYrKYyfUUncXYKkGnMb7offgL6aZEhQq0+6UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis2.png\"\n        title=\"redis2.png\"\n        src=\"/static/f6cab0a182499cc3e3c5c4058f28204e/37523/redis2.png\"\n        srcset=\"/static/f6cab0a182499cc3e3c5c4058f28204e/e9ff0/redis2.png 180w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/f21e7/redis2.png 360w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/37523/redis2.png 720w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/a016c/redis2.png 762w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>5) EmbeddedRedisConfig에 설정 추가</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// ...\npublic class EmbeddedRedisConfig {\n    // ...\n\n    @PostConstruct\n    public void startRedis() {\n        int port = isRedisRunning() ? findAvailablePort() : redisPort;\n\n        if (isArmMac()) {\n            redisServer = new RedisServer(getRedisFileForArcMac(), port);\n        } else {\n            redisServer = RedisServer.builder()\n                .port(port)\n                .setting(REDIS_SERVER_MAX_MEMORY)\n                .build();\n        }\n\n        try {\n            redisServer.start();\n        } catch (Exception e) {\n            throw new MoabamException(e.getMessage());\n        }\n    }\n\n    /**\n     * 현재 시스템이 ARM 아키텍처를 사용하는 MAC인지 확인\n     * System.getProperty(\"os.arch\") : JVM이 실행되는 시스템 아키텍처 반환\n     * System.getProperty(\"os.name\") : 시스템 이름 반환\n     */\n    private boolean isArmMac() {\n        return Objects.equals(System.getProperty(\"os.arch\"), \"aarch64\")\n            &amp;&amp; Objects.equals(System.getProperty(\"os.name\"), \"Mac OS X\");\n\t}\n    \n    /**\n     * ARM 아키텍처를 사용하는 Mac에서 실행할 수 있는 Redis 바이너리 파일을 반환\n     */\n    private File getRedisFileForArcMac() {\n        try {\n            return new ClassPathResource(\"binary/redis/redis-server-arm64\").getFile();\n        } catch (Exception e) {\n            throw new MoabamException(e.getMessage());\n        }\n    }\n}</code></pre></div>\n<p><strong>실행 결과</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQY00WRaW6DMBBGOUirpomSKgFsY3Yw+w6BpKl6/6N8lSet+uNpxpb8ZrGxbA9kRYMkq+CHKbwghs0lwYRL2PyP5z13PDgygMUFwlQhLxtCeiGMqhuw3r6w3b9RNQPJ87JFmlUI45yIkgJxWiBRJdF0E5b1k6QvrzvsDye87Q543x9hmEwgUgrz9YZlveO6PTAtG8q6QxgrqLymrjWmLXA2GYT04foR5abF4fkxojijAsbF4nB8H1XTo+1n9ONCsnFe0Q0zFSrrHiqvYDGHVqDFQgbQby8mAxcuRZs5T6EMQzT9hGG6Eu1vPs0bxaYbqVhRtciKmjrTe/zvMIJ0A4KEzHFpvDjNiSBKkagCUZLRzvS4+pxmJXWoRfpzPs4WjqcLSRmXEI6HH4J0xzqctAP6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis3.png\"\n        title=\"redis3.png\"\n        src=\"/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/37523/redis3.png\"\n        srcset=\"/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/e9ff0/redis3.png 180w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/f21e7/redis3.png 360w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/37523/redis3.png 720w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/302a4/redis3.png 1080w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/21b4d/redis3.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://redis.io/docs/reference/arm/\">Redis 공식 문서</a></li>\n<li><a href=\"https://jojoldu.tistory.com/297\">기억보단 기록을 - Spring Boot Data Redis 로컬/통합 테스트 환경 구축</a></li>\n<li><a href=\"https://velog.io/@hakjong/ARM-Mac-M1-%EC%97%90%EC%84%9C-embedded-redis-%EC%82%AC%EC%9A%A9\">ARM MAC M1에서 Embedded Redis 적용</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%B0%B0%EA%B2%BD\">배경</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#spring-data-redis\">Spring Data Redis</a></li>\n<li><a href=\"#lettuce\">Lettuce</a></li>\n<li><a href=\"#embedded-redis\">Embedded Redis</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#embedded-redis-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">Embedded Redis 적용하기</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85---m1-arm\">트러블 슈팅 - M1 ARM</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">문제 상황</a></li>\n<li><a href=\"#%EC%9B%90%EC%9D%B8\">원인</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">해결 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>\n</div>","excerpt":"안녕하세요. 현재 데브코스 4기로 활동 중인 모아밤팀 서버 개발자 홍혁준입니다.  이번 포스팅에서 Embedded Redis에 대해 이야기를 풀어내 보려고 합니다. 감사합니다. 배경 모아밤에서는 다음 요구사항을 위해 Redis 저장소를 활용하게 되었습니다. 사용자는 다른 사용자에게 12시간 마다 1회 콕 알림을 보낼 수 있다. 사용자는 자신이 속한 방의 인증타임에 알림이 울립니다. 개인적으로 프로젝트 코드를 누군가가 클론했을 때, 즉시 로컬 환경에서는 개발 및 테스트를 시작할 수 있어야 한다고 생각합니다. 때문에, 테스트 할 수 있는 환경 구성이 필요하게 되었고 Embedded Redis을 적용하게 되었습니다. 사용할 기술은 다음과 같습니다. Spring Data Redis Redis를 마치 JPA Repository 이용하듯 인터페이스를 제공하는 Spring Module 입니다. Lettuce Redis Java Client로 현재 Spring Data Redis에서 공식 지원하…","frontmatter":{"date":"November 04, 2023","title":"Embedded Redis 테스트 환경 적용기 (feat. M1-ARM)","categories":"Tech","author":"홍혁준","emoji":"🧢"},"fields":{"slug":"/Embedded-Redis/"}},"next":null,"prev":null,"site":{"siteMetadata":{"siteUrl":"https://team-moabam.github.io","comments":{"utterances":{"repo":"team-moabam/team-moabam.github.io"}}}}},"pageContext":{"slug":"/Embedded-Redis/","nextSlug":"","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}