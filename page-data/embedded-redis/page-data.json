{"componentChunkName":"component---src-templates-blog-template-js","path":"/embedded-redis/","result":{"data":{"cur":{"id":"45b720e5-9cfe-5c92-9bbd-571625ab982c","html":"<p>안녕하세요. 현재 데브코스 4기로 활동 중인 모아밤팀 서버 개발자 홍혁준입니다. </p>\n<p>이번 포스팅에서 <code class=\"language-text\">Embedded Redis</code>에 대해 이야기를 풀어내 보려고 합니다. 감사합니다.</p>\n<hr>\n<h2 id=\"배경\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EA%B2%BD\" aria-label=\"배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배경</h2>\n<p>모아밤에서는 다음 요구사항을 위해 <code class=\"language-text\">Redis</code> 저장소를 활용하게 되었습니다.</p>\n<ul>\n<li>사용자는 다른 사용자에게 12시간 마다 1회 콕 알림을 보낼 수 있다.</li>\n<li>사용자는 자신이 속한 방의 인증타임에 알림이 울립니다.</li>\n</ul>\n<p>개인적으로 프로젝트 코드를 누군가가 클론한다면,\n그 즉시 개발 및 테스트를 시작할 수 있어야 한다고 생각합니다.\n때문에, 테스트 할 수 있는 환경 구성을 위해 <code class=\"language-text\">Embedded Redis</code>를 적용하게 되었습니다. 기술 환경은 다음과 같습니다.</p>\n<p><strong>Spring Data Redis</strong></p>\n<ul>\n<li><code class=\"language-text\">Redis</code>를 마치 <code class=\"language-text\">JPA Repository</code> 이용하듯 인터페이스를 제공하는 <code class=\"language-text\">Spring Module</code> 입니다.</li>\n</ul>\n<p><strong>Lettuce</strong></p>\n<ul>\n<li><code class=\"language-text\">Redis Java Client</code>로 현재 <code class=\"language-text\">Spring Data Redis</code>에서 공식 지원하는 클라이언트입니다.</li>\n<li>추가로 <code class=\"language-text\">Jedis</code>도 공식 지원하지만, 거의 업데이트 되지 않아서 <code class=\"language-text\">Lettuce</code>를 선택하게 되었습니다.</li>\n</ul>\n<p><strong>Embedded Redis</strong></p>\n<ul>\n<li>H2와 같은 내장 Redis 데몬입니다. 즉, 로컬 환경 <code class=\"language-text\">Redis</code>를 실행하지 않아도 됩니다.</li>\n</ul>\n<hr>\n<h2 id=\"embedded-redis-적용하기\" style=\"position:relative;\"><a href=\"#embedded-redis-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"embedded redis 적용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Embedded Redis 적용하기</h2>\n<p><strong>1) build.gradle 설정</strong></p>\n<ul>\n<li>내장 <code class=\"language-text\">Redis</code>는 <a href=\"https://github.com/ozimov/embedded-redis\">it.ozimov</a> 외에도 <a href=\"https://github.com/kstyrc/embedded-redis\">kstyrc</a>가 있는데, <code class=\"language-text\">kstyrc</code> 오랫동안 업데이트가 없어서 <code class=\"language-text\">kstyrc</code>를 <code class=\"language-text\">Fork</code>해서 만들어진 <code class=\"language-text\">it.ozimov</code> 모듈을 사용하게 되었습니다.</li>\n<li><code class=\"language-text\">it.ozimov</code>는 최신 버전으로 <code class=\"language-text\">0.7.3</code>이 있습니다. 다만, 해당 버전은 <a href=\"https://github.com/ozimov/embedded-redis/pull/18\">SLF4J가 여러번 바인딩되는 문제</a>가 발생해서 <code class=\"language-text\">0.7.2</code> 버전을 사용하게 되었습니다. 또 다른 해결 방법으로는 컴파일 시 <code class=\"language-text\">SLF4J</code>를 제외하는 방법이 있기도 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// Redis\nimplementation <span class=\"token string\">'org.springframework.boot:spring-boot-starter-data-redis'</span>\n\n// Embedded-Redis\nimplementation group: <span class=\"token string\">'it.ozimov'</span>, name: <span class=\"token string\">'embedded-redis'</span>, version: <span class=\"token string\">'0.7.2'</span>\n\n// <span class=\"token number\">0.7</span>.3 버전으로 할 때, SLF4J를 제외하는 방법\nimplementation <span class=\"token punctuation\">(</span><span class=\"token string\">'it.ozimov:embedded-redis:0.7.3'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> exclude group: <span class=\"token string\">\"org.slf4j\"</span>, module: <span class=\"token string\">\"slf4j-simple\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>2) Embedded Redis 시작 및 종료 설정</strong></p>\n<ul>\n<li><code class=\"language-text\">@Profile</code>로 로컬 환경일 때만, 실행되도록 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"local\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmbeddedRedisConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${spring.data.redis.port}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> redisPort<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisServer</span> redisServer<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">startRedis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        redisServer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisServer</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        redisServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PreDestroy</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">stopRedis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        redisServer<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>3) 통합 테스트 환경 구성</strong></p>\n<ul>\n<li>2단계까지만 설정 시, 여러 스프링 컨텍스트 실행할 때, <code class=\"language-text\">Embedded Redis</code> 포트 충돌이 날 수 있습니다.</li>\n</ul>\n<p>즉, 서로 다른 <code class=\"language-text\">Property</code>를 가진 테스트 코드가 있는 경우 충돌이 날 수 있습니다. 때문에, 아래와 같이 추가 설정이 필요합니다.</p>\n<ul>\n<li><code class=\"language-text\">startRedis()</code>에서 메모리 할당을 명시했습니다. 이를 안할 시, <a href=\"https://github.com/kstyrc/embedded-redis/issues/77\">윈도우 환경에서는 문제</a>가 발생합니다.</li>\n<li>그 외 설명은 주석을 확인바랍니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">EmbeddedRedisConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ...</span>\n    \n    <span class=\"token comment\">/**\n     * REDIS_SERVER_MAX_MEMORY : \"maxmemory 128M\"\n     */</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">startRedis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token function\">isRedisRunning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">findAvailablePort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> redisPort<span class=\"token punctuation\">;</span>\n        redisServer <span class=\"token operator\">=</span> <span class=\"token class-name\">RedisServer</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">port</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">setting</span><span class=\"token punctuation\">(</span><span class=\"token constant\">REDIS_SERVER_MAX_MEMORY</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        redisServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PreDestroy</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">stopRedis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>redisServer <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            redisServer<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 현재 PC 서버에서 사용 가능한 포트 조회\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">findAvailablePort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span> port <span class=\"token operator\">&lt;=</span> <span class=\"token number\">65535</span><span class=\"token punctuation\">;</span> port<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Process</span> process <span class=\"token operator\">=</span> <span class=\"token function\">executeGrepProcessCommand</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isRunning</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> port<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MoabamException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ErrorMessage</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NOT_FOUND_AVAILABLE_PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Embedded Redis가 현재 실행 중인지 확인\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isRedisRunning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">isRunning</span><span class=\"token punctuation\">(</span><span class=\"token function\">executeGrepProcessCommand</span><span class=\"token punctuation\">(</span>redisPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 해당 Port를 사용 중인 프로세스를 확인하는 sh 실행\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Process</span> <span class=\"token function\">executeGrepProcessCommand</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> redisPort<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// netstat -nat : 시스템 네트워크 연결 상태 확인 명령어</span>\n        <span class=\"token comment\">// grep LISTEN : 'LISTEN'이 포함된 줄 확인 명령어</span>\n        <span class=\"token comment\">// grep %d : 앞서 주어진 출력 내용에서 포트번호가 포함된 줄 확인 명령어</span>\n        <span class=\"token class-name\">String</span> command <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"netstat -nat | grep LISTEN | grep %d\"</span><span class=\"token punctuation\">,</span> redisPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">//  '/bin/sh'에서 '-c' 옵션과 함께 위에서 만든 command를 실행하는 명령을 배열 형태로 구성</span>\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> shell <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"/bin/sh\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span> command<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Runtime</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRuntime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>shell<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MoabamException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 해당 Process가 현재 실행 중인지 확인\n     */</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isRunning</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Process</span> process<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> line<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">StringBuilder</span> pidInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BufferedReader</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>line <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                pidInfo<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MoabamException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ErrorMessage</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ERROR_EXECUTING_EMBEDDED_REDIS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>pidInfo<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2 id=\"트러블-슈팅---m1-arm\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85---m1-arm\" aria-label=\"트러블 슈팅   m1 arm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트러블 슈팅 - M1 ARM</h2>\n<h3 id=\"문제-상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"문제 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 상황</h3>\n<p>테스트 환경에서 <code class=\"language-text\">Ebmedded Redis</code>가 동작하게 구성했는데, <code class=\"language-text\">M1</code>에서는 <code class=\"language-text\">Database</code>가 실행되지 않는 현상이\n발생했습니다.</p>\n<hr>\n<h3 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인</h3>\n<p><code class=\"language-text\">Embedded Redis</code> 라이브러리에서 <code class=\"language-text\">mac_arm64</code> 용 바이너리가 준비되어 있지 않고 소스 코드에도\n<code class=\"language-text\">MAC_OS_X_arm64</code>가 없는 것이 원인입니다.</p>\n<hr>\n<h3 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h3>\n<p><strong>1) brew를 통한 wget 설치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install wget</code></pre></div>\n<p><strong>2) 소스 코드 다운로드 및 컴파일</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 소스 코드 다운로드\nwget https://download.redis.io/releases/redis-7.2.3.tar.gz\n\n// 압축 해제\ntar xzf redis-7.2.3.tar.gz \n\n// 디렉토리 이동\ncd redis-7.2.3\n\n// 파일 링크 및 설치 등\nmake</code></pre></div>\n<p><strong>3) 바이너리 파일 실행 여부 확인</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src/redis-server</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQoz52S2Y6DMAxFwy52EAjB/3+oR8fqTVPaGanzcOPg2Ce2Sdj33aZpsnmebVkWt+M4RjsMg63ral3X+R7hb9vWY8itqsqyLLOiKCyEEFjcUZalHz4OovhumsYt57qormsXuTFeIILZE5DnuSfiJwgfAHzY8zyNzgBTOfERKEAqVQQQkQRg27bYNi1j005cqk7JalkVcgGJx3HYdV3uf4PcgUpEukDQ+zwZC3Evc0uVJqdVCpbOhz/a932c3UeoQAIzU0G1/7PFu35rNR3DV0AW/dm0Kj2jL2HPh52C/1FV1A8+beV7CWkQKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis1.png\"\n        title=\"redis1.png\"\n        src=\"/static/f86e9de351ba312b8fc358dfea5e3de1/37523/redis1.png\"\n        srcset=\"/static/f86e9de351ba312b8fc358dfea5e3de1/e9ff0/redis1.png 180w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/f21e7/redis1.png 360w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/37523/redis1.png 720w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/302a4/redis1.png 1080w,\n/static/f86e9de351ba312b8fc358dfea5e3de1/4ad3a/redis1.png 1152w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4) 바이너리 파일을 프로젝트에 추가</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABo0lEQVQoz5WS227TQBCG/SZcIJrY6z043vjYJMaJm6QJhcQiQbxBaRFC4gKJCx79Q17jCNobuPj0787ujHZnfi+Qho5yXtNs9ti05NVY4IfaxQf9V7whSaiIJL9mUTdUyxukif+r2HDX+zOYXb+mbnZsd3eu4Fgo/LC//Bzz1/ryQj9U+EIipMLEKfliy/5tS5ykhMoQatOr0k6ljpwKt+9jQmpXww8lXqATgqgkMAUiyvHtmqRqWW4O2KJhki+Zlo3D5ivi30yypTuzZYNJKnxTuDpemB9Rq6/I+gG9+sJs/8j2/I31x5805x9U7XdGi3vGHdU9/uITonpA1o9P+OzwAj0lMP0LO2RcUlYb5ss3rG5bVusD76ojp+bMoX7Ptr7FZnPGOkdExSVvoO9h2P+/60MgFUleMq9qbrY7imJGOcmY2YIizkitxRjNOAj7vg2EQw+fWSAispnz5GZ3R6AjrkLJSClGUjHqptoNwkQEKnIqdHSZtPfUR50fX7y84tieaD+cEKliUibEsykms5jcYrKYyfUUncXYKkGnMb7offgL6aZEhQq0+6UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis2.png\"\n        title=\"redis2.png\"\n        src=\"/static/f6cab0a182499cc3e3c5c4058f28204e/37523/redis2.png\"\n        srcset=\"/static/f6cab0a182499cc3e3c5c4058f28204e/e9ff0/redis2.png 180w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/f21e7/redis2.png 360w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/37523/redis2.png 720w,\n/static/f6cab0a182499cc3e3c5c4058f28204e/a016c/redis2.png 762w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>5) EmbeddedRedisConfig에 설정 추가</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// ...\npublic class EmbeddedRedisConfig {\n    // ...\n\n    @PostConstruct\n    public void startRedis() {\n        int port = isRedisRunning() ? findAvailablePort() : redisPort;\n\n        if (isArmMac()) {\n            redisServer = new RedisServer(getRedisFileForArcMac(), port);\n        } else {\n            redisServer = RedisServer.builder()\n                .port(port)\n                .setting(REDIS_SERVER_MAX_MEMORY)\n                .build();\n        }\n\n        try {\n            redisServer.start();\n        } catch (Exception e) {\n            throw new MoabamException(e.getMessage());\n        }\n    }\n\n    /**\n     * 현재 시스템이 ARM 아키텍처를 사용하는 MAC인지 확인\n     * System.getProperty(\"os.arch\") : JVM이 실행되는 시스템 아키텍처 반환\n     * System.getProperty(\"os.name\") : 시스템 이름 반환\n     */\n    private boolean isArmMac() {\n        return Objects.equals(System.getProperty(\"os.arch\"), \"aarch64\")\n            &amp;&amp; Objects.equals(System.getProperty(\"os.name\"), \"Mac OS X\");\n\t}\n    \n    /**\n     * ARM 아키텍처를 사용하는 Mac에서 실행할 수 있는 Redis 바이너리 파일을 반환\n     */\n    private File getRedisFileForArcMac() {\n        try {\n            return new ClassPathResource(\"binary/redis/redis-server-arm64\").getFile();\n        } catch (Exception e) {\n            throw new MoabamException(e.getMessage());\n        }\n    }\n}</code></pre></div>\n<p><strong>실행 결과</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQY00WRaW6DMBBGOUirpomSKgFsY3Yw+w6BpKl6/6N8lSet+uNpxpb8ZrGxbA9kRYMkq+CHKbwghs0lwYRL2PyP5z13PDgygMUFwlQhLxtCeiGMqhuw3r6w3b9RNQPJ87JFmlUI45yIkgJxWiBRJdF0E5b1k6QvrzvsDye87Q543x9hmEwgUgrz9YZlveO6PTAtG8q6QxgrqLymrjWmLXA2GYT04foR5abF4fkxojijAsbF4nB8H1XTo+1n9ONCsnFe0Q0zFSrrHiqvYDGHVqDFQgbQby8mAxcuRZs5T6EMQzT9hGG6Eu1vPs0bxaYbqVhRtciKmjrTe/zvMIJ0A4KEzHFpvDjNiSBKkagCUZLRzvS4+pxmJXWoRfpzPs4WjqcLSRmXEI6HH4J0xzqctAP6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis3.png\"\n        title=\"redis3.png\"\n        src=\"/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/37523/redis3.png\"\n        srcset=\"/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/e9ff0/redis3.png 180w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/f21e7/redis3.png 360w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/37523/redis3.png 720w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/302a4/redis3.png 1080w,\n/static/8aeba7c9fe0be05a5ed842ec9e7d72ca/21b4d/redis3.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6UlEQVQY042QyW7CQBBE/QGJWIzXscezmIExHmyWkKBwRvn/H3oRDrdcODyVVKXuVleUFA1rP+DDGR9OiGbNw0tLRVK8RlpqMmHJSk1UdBIzetx2YL0NE0Ja3mYr3ufJS8wTySKzzGJBFBcV0jqsC1jXo6wnrzRxWpHkkkVSskjEn67+s3xmcaZYZg1RKjR2ExhOVw4fN8bzN/34STh8YdweaTyicVRqQ6231NojbUdjO2rzON5OrwozUqieKKs09/sPx8ttWrQ/XtkNF4wLqHY3DT1UtT2N3ZHXLcWTvLJkwkx9lyqQy45fNQqH886h170AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis4.png\"\n        title=\"redis4.png\"\n        src=\"/static/0756b06d65b545207726591874f7d6ec/37523/redis4.png\"\n        srcset=\"/static/0756b06d65b545207726591874f7d6ec/e9ff0/redis4.png 180w,\n/static/0756b06d65b545207726591874f7d6ec/f21e7/redis4.png 360w,\n/static/0756b06d65b545207726591874f7d6ec/37523/redis4.png 720w,\n/static/0756b06d65b545207726591874f7d6ec/302a4/redis4.png 1080w,\n/static/0756b06d65b545207726591874f7d6ec/21b4d/redis4.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://redis.io/docs/reference/arm/\">Redis 공식 문서</a></li>\n<li><a href=\"https://jojoldu.tistory.com/297\">기억보단 기록을 - Spring Boot Data Redis 로컬/통합 테스트 환경 구축</a></li>\n<li><a href=\"https://velog.io/@hakjong/ARM-Mac-M1-%EC%97%90%EC%84%9C-embedded-redis-%EC%82%AC%EC%9A%A9\">ARM MAC M1에서 Embedded Redis 적용</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%B0%B0%EA%B2%BD\">배경</a></p>\n</li>\n<li>\n<p><a href=\"#embedded-redis-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">Embedded Redis 적용하기</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85---m1-arm\">트러블 슈팅 - M1 ARM</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">문제 상황</a></li>\n<li><a href=\"#%EC%9B%90%EC%9D%B8\">원인</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\">해결 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#reference\">Reference</a></p>\n</li>\n</ul>\n</div>","excerpt":"안녕하세요. 현재 데브코스 4기로 활동 중인 모아밤팀 서버 개발자 홍혁준입니다.  이번 포스팅에서 에 대해 이야기를 풀어내 보려고 합니다. 감사합니다. 배경 모아밤에서는 다음 요구사항을 위해  저장소를 활용하게 되었습니다. 사용자는 다른 사용자에게 12시간 마다 1회 콕 알림을 보낼 수 있다. 사용자는 자신이 속한 방의 인증타임에 알림이 울립니다. 개인적으로 프로젝트 코드를 누군가가 클론한다면,\n그 즉시 개발 및 테스트를 시작할 수 있어야 한다고 생각합니다.\n때문에, 테스트 할 수 있는 환경 구성을 위해 를 적용하게 되었습니다. 기술 환경은 다음과 같습니다. Spring Data Redis 를 마치  이용하듯 인터페이스를 제공하는  입니다. Lettuce 로 현재 에서 공식 지원하는 클라이언트입니다. 추가로 도 공식 지원하지만, 거의 업데이트 되지 않아서 를 선택하게 되었습니다. Embedded Redis H2와 같은 내장 Redis 데몬입니다. 즉, 로컬 환경 를 실행하지 않아도…","frontmatter":{"date":"November 04, 2023","title":"Embedded Redis 테스트 환경 적용기 (feat. M1-ARM)","categories":"Tech","author":"홍혁준","emoji":"🧑🏻‍💻"},"fields":{"slug":"/embedded-redis/"}},"next":null,"prev":{"id":"42b0801c-543e-5972-859a-5c4d7e06796f","html":"<p>안녕하세요. 현재 데브코스 4기로 활동 중인 모아밤팀 서버 개발자 홍혁준입니다.</p>\n<p>이번 포스팅에서 <code class=\"language-text\">FCM Push</code>에 대해 이야기를 풀어내 보려고 합니다. 감사합니다.</p>\n<hr>\n<h2 id=\"모아밤-서비스에는-어떤-push-알림이-필요할까\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EC%95%84%EB%B0%A4-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90%EB%8A%94-%EC%96%B4%EB%96%A4-push-%EC%95%8C%EB%A6%BC%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A0%EA%B9%8C\" aria-label=\"모아밤 서비스에는 어떤 push 알림이 필요할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모아밤 서비스에는 어떤 Push 알림이 필요할까?</h2>\n<p>푸시 알림이란 사용자가 서비스를 사용하고 있지 않은 상황에서도 사용자에게 알림을 보내는 방법입니다.</p>\n<p>푸시 알림을 가장 단순하게 구현하는 방법은 <code class=\"language-text\">Polling</code> 방식으로 주기적으로 서버에 편지 도착 여부를 묻는 <code class=\"language-text\">HTTP</code> 요청을 보내는 방법이 있는데요. 이 <code class=\"language-text\">Polling</code> 방식은 <code class=\"language-text\">Short Polling</code>과 <code class=\"language-text\">Long Polling</code> 방식이 있는데, <code class=\"language-text\">Short Polling</code>은 서버가 줄 데이터가 없음에도 주기적으로 요청과 응답 작업을 반복해야 해서 불필요한 트래픽이 발생합니다. 반면 <code class=\"language-text\">Long Polling</code>은 <code class=\"language-text\">Short Polling</code> 방식에 비해 불필요한 요청과 응답을 반복하지 않아도 되지만, 클라이언트와 연결을 계속 유지해야 해서 서버 자원을 소모하게 되죠. 이런 단점들로 인해 <code class=\"language-text\">FCM</code>을 찾아보게 되었습니다.</p>\n<p>모아밤 서비스는 앱, 웹을 지원해야 합니다. 그리고 현재 모아밤에서 구현하고자 하는 기능은 사용자가 원할 때, 다른 사용자에게 제한된 횟수만큼 알림을 보내야 합니다. 또한 서버 시간에 따라서 주기적으로 푸시 알림을 보내는 기능입니다. 이런 요구사항을 종합해 봤을 때, <code class=\"language-text\">FCM</code>을 선택하게 되었습니다. 그럼 이제 <code class=\"language-text\">FCM</code>을 도입하기 전 사전지식을 얻어봅시다.</p>\n<hr>\n<h2 id=\"fcmfirebase-cloud-messaging\" style=\"position:relative;\"><a href=\"#fcmfirebase-cloud-messaging\" aria-label=\"fcmfirebase cloud messaging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FCM(Firebase Cloud Messaging)</h2>\n<p><code class=\"language-text\">FCM</code>은 무료로 메시지를 안정적으로 전송할 수 있는 교차 플랫폼 메시징 솔루션입니다. 이는 특정 개인에게 메시지를 보낼 수도 있고 특정 토픽을 구독하는 사용자에게 전체 메시지를 보낼 수도 있죠.</p>\n<p>주요 기능으로는 사용자에게 표시되는 푸시 알림 메시지 전송과 애플리케이션 단에서 처리하는 데이터 메시지 전송이 있습니다. 또한 단일 기기 (특정 사용자), 기기 그룹 (사용자 그룹), 주제를 구독한 기기 (토픽의 구독)을 타겟팅 할 수도 있습니다. 자세한 정보는 <a href=\"https://firebase.google.com/docs/cloud-messaging/concept-options?hl=ko\">공식 문서</a>를 확인 바랍니다.</p>\n<hr>\n<h3 id=\"fcm-token-이란\" style=\"position:relative;\"><a href=\"#fcm-token-%EC%9D%B4%EB%9E%80\" aria-label=\"fcm token 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FCM Token 이란?</h3>\n<p>어플리케이션이 FCM 서버와 통신하기 위해 사용되는 고유한 식별자로\u001f어플리케이션이 서버와 통신할 때 토큰을 사용해 FCM 서버에서 어플리케이션을 식별하고 이를 통해 메시지 전송을 할 수 있습니다.</p>\n<h4 id=\"토큰-생성\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%83%9D%EC%84%B1\" aria-label=\"토큰 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 생성</h4>\n<p>어플리케이션을 처음 실행할 때 FCM SDK는 클라이언트 인스턴스에 대한 등록 토큰을 생성합니다.</p>\n<h4 id=\"토큰-만료\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EB%A7%8C%EB%A3%8C\" aria-label=\"토큰 만료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 만료</h4>\n<p>FCM 토큰은 정해진 수명이나 갱신 주기는 없고\u001d 아래의 이벤트가 발생할 때 만료합니다.</p>\n<ul>\n<li>어플리케이션 인스턴스 ID를 삭제했을 때,</li>\n<li>어플리케이션이 새 기기에서 복원되었을 때,</li>\n<li>사용자가 어플리케이션을 제거 및 재설치했을 때,</li>\n<li>사용자가 어플리케이션 데이터를 지웠을 때,</li>\n</ul>\n<hr>\n<h3 id=\"푸시-알림을-위한-3가지-컴포넌트\" style=\"position:relative;\"><a href=\"#%ED%91%B8%EC%8B%9C-%EC%95%8C%EB%A6%BC%EC%9D%84-%EC%9C%84%ED%95%9C-3%EA%B0%80%EC%A7%80-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8\" aria-label=\"푸시 알림을 위한 3가지 컴포넌트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>푸시 알림을 위한 3가지 컴포넌트</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzklEQVQY021Quw6CQBDkg/wC/87EH/EXtLajsbEhodGCQikEhMvhPdg7xuwaNAE32WT3JjM3s4n3HtZaGGMwDAPmFQPBeyfzOI5LPEbhE5HsiXMOdV2j6zoBWDSEIE0hIvgXbsct6uteBL8YkezMKYoCTdP8BNM0RZ7nYLdaa3FrjYHSPdpHifawgj2tMVD8YNZAKSUzc8qyFJ4I9n2PqqrEIT/OYzlncD9v8LzssAwMEc6yTERFkCPyL+yUo0y3mprrqQhK/8f4hsyd7v8GLNeByhW2EwoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm1.png\"\n        title=\"fcm1.png\"\n        src=\"/static/8995bff39bd32d05e01554ef99d23cf1/37523/fcm1.png\"\n        srcset=\"/static/8995bff39bd32d05e01554ef99d23cf1/e9ff0/fcm1.png 180w,\n/static/8995bff39bd32d05e01554ef99d23cf1/f21e7/fcm1.png 360w,\n/static/8995bff39bd32d05e01554ef99d23cf1/37523/fcm1.png 720w,\n/static/8995bff39bd32d05e01554ef99d23cf1/2c5fd/fcm1.png 1006w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h4 id=\"알림-제공자-service-application\" style=\"position:relative;\"><a href=\"#%EC%95%8C%EB%A6%BC-%EC%A0%9C%EA%B3%B5%EC%9E%90-service-application\" aria-label=\"알림 제공자 service application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>알림 제공자 (Service Application)</h4>\n<p>알림 요청을 만들어 <code class=\"language-text\">FCM</code>으로 보내주는 주체로 알림 요청을 위해서는 알림 요청을 보내는 데\n필요한 고유 식별자인 단말 토큰과 알림 내용을 담은 <code class=\"language-text\">JSON</code> 딕셔너리 형식의 페이로드(<code class=\"language-text\">Payload</code>)가 필요합니다.</p>\n<h4 id=\"fcm\" style=\"position:relative;\"><a href=\"#fcm\" aria-label=\"fcm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FCM</h4>\n<p><code class=\"language-text\">Google</code>이 제공하는 원격 서비스로 푸시 알림을 다양한 플랫폼으로 보내는 역할을 담당합니다.\n즉, <code class=\"language-text\">FCM</code>은 안드로이드, <code class=\"language-text\">iOS</code>, 웹을 포함한 다양한 플랫폼의 사용자에게 메시지를 보낼 수 있는 크로스 플랫폼 메시징 솔루션입니다.</p>\n<h4 id=\"디바이스-장치\" style=\"position:relative;\"><a href=\"#%EB%94%94%EB%B0%94%EC%9D%B4%EC%8A%A4-%EC%9E%A5%EC%B9%98\" aria-label=\"디바이스 장치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디바이스 장치</h4>\n<p>푸시 알림을 수신하는 사용자 단말기입니다.</p>\n<hr>\n<h3 id=\"fcm-토큰의-신성도-보장\" style=\"position:relative;\"><a href=\"#fcm-%ED%86%A0%ED%81%B0%EC%9D%98-%EC%8B%A0%EC%84%B1%EB%8F%84-%EB%B3%B4%EC%9E%A5\" aria-label=\"fcm 토큰의 신성도 보장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FCM 토큰의 신성도 보장</h3>\n<p>서버 개발에서 핵심은 토큰의 신선도 보장이라고 생각합니다. <a href=\"https://firebase.google.com/docs/cloud-messaging/manage-tokens?hl=ko\">Firebase 공식 문서</a>에서도 언급됐지만, 데이터베이스에 토큰이 쌓이다 보면 주기적 알림 서비스의 경우에 발생할 수 있는 이슈가 존재합니다. 오래된 등록 토큰이 있는 비활성 장치에 메시지를 전송하면 리소스를 낭비하게 되고 푸시 알림의 전송 속도가 느려질 수 있기 때문이죠.</p>\n<p>따라서 주기적으로 토큰의 타임스탬프를 업데이트하는 서버 로직을 추가하고 오래된 토큰을 판정하기 위한 임계 기간 동안 토큰을 사용하지 않은 유저의 토큰을 삭제하고 업데이트하는 것이 좋을 것 같습니다.</p>\n<hr>\n<h3 id=\"fcm-흐름\" style=\"position:relative;\"><a href=\"#fcm-%ED%9D%90%EB%A6%84\" aria-label=\"fcm 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FCM 흐름</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQY01WQW26DMBBF2U131e1lB/1Ld4HUIPUHBSQEcXAAv82pxohI/bga2R6fe2eqnDPOOUIIeO85z9u2Ya3Fh4g3mhAyeYeUIiklYjyqSP5J/77vVAKapommacqlPIrWdeWln7gEr9sX4/cnzgx4n3DOFlORmCql6LquhKnEqe976roukGVZMMagteapHtgI6ueCvn6gxxrr8z+gpBqGgbZtj4RCFZez4RzlWIErrtuq6e+/xJjeY54SyDzPBSoJ/wDvmTOZruHIqAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm2.png\"\n        title=\"fcm2.png\"\n        src=\"/static/ac13bdf4e2a9661719de01ea71f2cd33/37523/fcm2.png\"\n        srcset=\"/static/ac13bdf4e2a9661719de01ea71f2cd33/e9ff0/fcm2.png 180w,\n/static/ac13bdf4e2a9661719de01ea71f2cd33/f21e7/fcm2.png 360w,\n/static/ac13bdf4e2a9661719de01ea71f2cd33/37523/fcm2.png 720w,\n/static/ac13bdf4e2a9661719de01ea71f2cd33/302a4/fcm2.png 1080w,\n/static/ac13bdf4e2a9661719de01ea71f2cd33/b94e3/fcm2.png 1126w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>가장 먼저 <code class=\"language-text\">FCM</code>과 앱을 연동합니다.</li>\n<li>알림 제공자(서비스 어플리케이션)는 <code class=\"language-text\">FCM</code>에 단말 토큰과 페이로드를 담아서 <code class=\"language-text\">HTTP POST</code> 요청을 보냅니다.</li>\n<li>요청을 받은 <code class=\"language-text\">FCM</code>은 알림 제공자에게 적절한 <code class=\"language-text\">HTTP</code> 응답을 보냅니다.</li>\n<li><code class=\"language-text\">FCM</code>은 메시지 우선순위, 수신 단말과의 통신 가능 여부 등을 고려해 메시지를 수신 단말에 보냅니다.</li>\n<li>수신 단말은 정보 이상 유무에 따라 적절한 <code class=\"language-text\">HTTP</code> 응답을 보냅니다.</li>\n</ol>\n<p>이렇게만 보면 이해가 잘 안갈 수도 있습니다. 더 자세한 흐름을 보여드리겠습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz4VSW27DMAzLbXe3XWNnGDCgBfa1Bm2ap9+ObQ5Ul7XpU4BgI2YoUVSFiyil4H6U1Y24R1ldk+Wc4ZxD27boug6TNvAZUN0Pms93lOzwLG4IeaaU0A4K+/0edV1jUB59/YX64w1j+w1tPLRW0FrDGCOFj8cjlFJnwoVsEWdDFrBWCqVkhBjQ9y1CiJjnWTLGKIqmaRJy3u92yDQ+wXsv+So4IpKL5IXgkgx/hAQyz2/5xgRRY+1/4QoPXNM+w1onYDxxdiEMIaxNuQ5lg8zQGP1SMrsjoazNIovJwQ7DIG4NQ4/NZoOmaaQDDv7S0b7vBTeOo2wDk7iKQF64KqeOjFQ7HA7YbrfY7XaIMYiDy0rRYZ78xjcST0qJMStTrsPGgpSBOWUhoDT+xGTRGGf6h9EEWD/fLvZ62AUuzNBuhnERxliRS4kcS9e1mJSG9UkwKZ+a+gX/yaw8jN8pywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm3.png\"\n        title=\"fcm3.png\"\n        src=\"/static/8ed6cc30d99e53bbab4b944858d72932/37523/fcm3.png\"\n        srcset=\"/static/8ed6cc30d99e53bbab4b944858d72932/e9ff0/fcm3.png 180w,\n/static/8ed6cc30d99e53bbab4b944858d72932/f21e7/fcm3.png 360w,\n/static/8ed6cc30d99e53bbab4b944858d72932/37523/fcm3.png 720w,\n/static/8ed6cc30d99e53bbab4b944858d72932/302a4/fcm3.png 1080w,\n/static/8ed6cc30d99e53bbab4b944858d72932/21b4d/fcm3.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>가장 먼저 기기가 어플리케이션을 설치 및 사용할 경우 발생합니다.</p>\n<ol>\n<li><code class=\"language-text\">Firebase</code>가 클라이언트에게 FCM 토큰을 생성해줍니다.</li>\n<li>클라이언트는 <code class=\"language-text\">Firebase</code>로부터 받은 <code class=\"language-text\">FCM Token</code>을 서버에게 저장 요청을 보냅니다.</li>\n</ol>\n<p>그리고 나서, 사용자가 클라이언트에 알림 요청하는 경우 발생합니다. 그리고 위 이미지에는 없지만 서버 자체에서 알람 요청을 하는 경우도 있습니다.</p>\n<ol>\n<li>클라이언트가 서버로 알림 생성 요청을 보냅니다.</li>\n<li>서버는 보내려는 메시지 데이터를 FCM 서버에 알람 요청을 합니다.</li>\n<li>FCM 서버는 해당 서버가 올바른지 확인 후 클라이언트에게 푸시 알람을 보냅니다.</li>\n</ol>\n<p>이제 사전지식을 어느정도 습득했으니 어떻게 도입했는 지 살펴봅시다.</p>\n<hr>\n<h2 id=\"알림-아키텍처\" style=\"position:relative;\"><a href=\"#%EC%95%8C%EB%A6%BC-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98\" aria-label=\"알림 아키텍처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>알림 아키텍처</h2>\n<p>모아밤 프로젝트에서 필요한 요구사항은 다음과 같습니다.</p>\n<ul>\n<li>방 참여자들은 다른 참여자들에게 12시간마다 1회의 콕 찌르기 알림을 보낼 수 있다.</li>\n<li>방 내의 루틴 인증 시작 타임이 된다면 방 참여자들에게 알림이 간다.</li>\n</ul>\n<p>요구사항을 봤을 때, 알림 제공자 역할을 하는 별도 인스턴스를 생성해 애플리케이션 서버와 알림 서버를 분리해야 할 지, 아니면 어플리케이션 서버에 알림 기능을 추기할 지 고민이 됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVQI12WMTQoCMQyFPbvgSdx5CBeu3HgLpc5MfwbbGVqb9pNWUMEHScjLy7fJ+spwOmCcw1lLWFbW2TAe9xijcc4RQuCZElIqYR4ZzltiuJOlIpKx1qK1pmnTmvNrN/qz98SUeKwJY8wf0M8j6rIj+htZ6MBpmlBKvYG1VooIfZbSq6lI/ngiwq+WCLV+93aPMfb8C0q35v23R06RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm4.png\"\n        title=\"fcm4.png\"\n        src=\"/static/ae6371dafeed0ed54e49949377609012/37523/fcm4.png\"\n        srcset=\"/static/ae6371dafeed0ed54e49949377609012/e9ff0/fcm4.png 180w,\n/static/ae6371dafeed0ed54e49949377609012/f21e7/fcm4.png 360w,\n/static/ae6371dafeed0ed54e49949377609012/37523/fcm4.png 720w,\n/static/ae6371dafeed0ed54e49949377609012/302a4/fcm4.png 1080w,\n/static/ae6371dafeed0ed54e49949377609012/21b4d/fcm4.png 1280w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>아무래도 어플리케이션에 존재하는 모든 방의 모든 참여자에게 알림을 인증 타임마다 보내야 하니, 푸시 알림 시스템이 대량 요청을 처리할 것으로 예상은 됩니다. 따라서 효과적으로 작동하는 데 필요한 리소스와 용량을 확보하기 위해 위 이미지와 같이 별도 인스턴스를 사용하는 것이 유용할 수도 있을 것 같습니다. 또한 별도 인스턴스를 사용하면 푸시 알림 시스템에 대한 격리 및 제어 기능을 더 많이 제공할 수도 있을 것 같습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY02VQS07FMAzsDbgnV3lLLsCKC3ADEBIblkhUpTT9SK+iQFuljZM0yYBNQU8w0ih24ozHztJrjtTe4y9ijEgp7QRCCAhpf0zpX+22bRJn9vYSy9U5HvNnNHWNl7JE0zTQWovYD+y7wvHuAJqedpEgQoxpmtC2reSZJYIjksthGDCOI5xzsNZiXVdYMtAU8FHeYLk+g1UXoA0go0FEMMag73uhCDrvwayqSroopTDPsxR77xF51Ags8xH1wwH6Ld+njr8TdF2HoijESMaqREY6sQg745jPU/BXdhbid3a6Rt6vNP9y+AnTi3/PA211eQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm5.png\"\n        title=\"fcm5.png\"\n        src=\"/static/8d95568d4730c50faa8ddbece422ce38/37523/fcm5.png\"\n        srcset=\"/static/8d95568d4730c50faa8ddbece422ce38/e9ff0/fcm5.png 180w,\n/static/8d95568d4730c50faa8ddbece422ce38/f21e7/fcm5.png 360w,\n/static/8d95568d4730c50faa8ddbece422ce38/37523/fcm5.png 720w,\n/static/8d95568d4730c50faa8ddbece422ce38/2e694/fcm5.png 1048w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>하지만 현재의 모아밤 서비스를 본다면, 주기적인 알림 외는 콕 찌르기를 하는 경우에만 알림 요청이 발생하고, 아직 개발 시작 단계이기 때문에, 사용자가 존재하지 않습니다. 만약 개발이 끝나고 운영 단계라고 하여도 사용자가 그리 많지 않을 것 같습니다. 😢 때문에 기존 응용 프로그램과 동일한 인스턴스를 사용하기로 결정했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVQ4y52Uy24TMRSG8xg8AI/BAqlIiAXvwAuwYc+Kh+AdQGLLEqSyIS1SKUJq2SSoVEkm8Xjcia9jz4fmkuZKBRzJI8tjfz7n/8/MoK5rmuieEIJCm1+kFLr1uma1529i0B4KgaQ1yVlkcYaQpxh7fQv8l2iByVrqqiKlhFQ/mIsvGCvoWP+RYXKuBWpjyLIZWTZhni2w1m6VXafUjZVMBy4a1BsZ7sYtaOfgXRkPeicgpXYao8X5RXPNNsQY5MkJ5Xh8p1mDpswbKVFF0Wt4jpBDCjXGuUAIHm0tH1885/3RQ94cPaCcTTpoSvvARqdSSkqlWqAqLxHFGTflBGs93nuM9xy/esnr+/d4+/QRy2z2Z2BXsm9qYKkNi0XGZDqiKBQxxq3NF8cfKKZ9dnXa03rLlBQ6U5zzCNFlu2lKOw6YtaljM1+3TZ+NtUuuri737UseOfqMWaq9V1Xfw+s+NKbLUmtU8R2pTlnqa7yPOGfxoUKJOdN3T5DDZzgfWm211jjnMMa08/WnF2P3pRhNnn8ly4cYMyOEiPeOqork8xnq02PstwYYCSG0jd+AhRDked5ruPNzsLYkm48ONu3P8QXTyfXe+grcAH8Dvr488s/uoyAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm6.png\"\n        title=\"fcm6.png\"\n        src=\"/static/9a819aa65edbb92a888a8865c91ea706/37523/fcm6.png\"\n        srcset=\"/static/9a819aa65edbb92a888a8865c91ea706/e9ff0/fcm6.png 180w,\n/static/9a819aa65edbb92a888a8865c91ea706/f21e7/fcm6.png 360w,\n/static/9a819aa65edbb92a888a8865c91ea706/37523/fcm6.png 720w,\n/static/9a819aa65edbb92a888a8865c91ea706/587b0/fcm6.png 970w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>추가적으로 요구사항을 보면 “인증 타임 당 1회의 콕 찌르기 알림을 보낼 수 있다.”를 충족하기 위해, <code class=\"language-text\">Redis</code> 저장소를 활용할 것입니다. 또한 정해진 인증타임에 푸시를 자동발송 해야하니 스케쥴러를 활용할 예정입니다. 즉, 위 이미지와 같은 아키텍처가 나오게 됩니다.</p>\n<p>해당 아키텍처 선정 이유를 정리하면 다음과 같습니다.</p>\n<ul>\n<li>현재 상황에선 하나의 <code class=\"language-text\">EC2</code>로도 충분합니다. 굳이 2개로 분리하는 것은 비용 문제가 발생합니다.</li>\n<li>초기 서비스이기 때문에, 사용자가 적은 만큼 트래픽이 많이 발생하지 않습니다. 즉, 인증 타임마다 <code class=\"language-text\">Spring Batch</code>를 돌리기엔, 서버가 너무 무거워집니다. 오버 엔지니어링입니다.</li>\n<li>인증 타임이 됐을 때, 시간 내에 인증을 해야 해서 신속하게 푸시 메시지가 발송되도록 카프카를 적용하는 것도 고려해볼 수 있습니다. 하지만, 위와 동일한 이유로 오버 엔지니어링이라고 생각합니다.</li>\n<li>주니어 개발자로서 아직은 현재 사용되는 기술에 대한 이해와 공부가 먼저입니다.</li>\n</ul>\n<p>위와 같은 이유로 해당 아키텍처로 진행하게 되었습니다.</p>\n<hr>\n<h2 id=\"모아밤의-fcm-도입기\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EC%95%84%EB%B0%A4%EC%9D%98-fcm-%EB%8F%84%EC%9E%85%EA%B8%B0\" aria-label=\"모아밤의 fcm 도입기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모아밤의 FCM 도입기</h2>\n<h3 id=\"디펜던시-등록\" style=\"position:relative;\"><a href=\"#%EB%94%94%ED%8E%9C%EB%8D%98%EC%8B%9C-%EB%93%B1%EB%A1%9D\" aria-label=\"디펜던시 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>디펜던시 등록</h3>\n<p><code class=\"language-text\">build.gradle</code>을 설정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Firebase Admin\nimplementation 'com.google.firebase:firebase-admin:9.2.0'</code></pre></div>\n<hr>\n<h3 id=\"firebase-연동-준비\" style=\"position:relative;\"><a href=\"#firebase-%EC%97%B0%EB%8F%99-%EC%A4%80%EB%B9%84\" aria-label=\"firebase 연동 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Firebase 연동 준비</h3>\n<p>Firebase 연동 준비는 제가 참고한 <a href=\"https://velog.io/@heelieben/FCM-React-Web-Push-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-feat.-pwa-service-worker\">React + FCM 구현하기</a>와 <a href=\"https://zuminternet.github.io/FCM-PUSH/\">FCM 푸시 파헤치기</a>를 참고하시면 됩니다!</p>\n<hr>\n<h3 id=\"spring-boot-설정\" style=\"position:relative;\"><a href=\"#spring-boot-%EC%84%A4%EC%A0%95\" aria-label=\"spring boot 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Boot 설정</h3>\n<p><strong>1) Firebase Config 설정</strong></p>\n<ul>\n<li><code class=\"language-text\">Firebase</code> 앱 내, 프로젝트의 권한을 얻기 위해서는 <code class=\"language-text\">SDK</code> 권한키를 필수로 보유해야 합니다.</li>\n<li>공식문서에서 제공된 방식과 다르게 절대 <code class=\"language-text\">ClassPathResource</code>를 활용했습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@Slf4j\n@Configuration\npublic class FcmConfig {\n\n    @Bean\n    public FirebaseMessaging firebaseMessaging() {\n        try (InputStream inputStream = new ClassPathResource(FIREBASE_PATH).getInputStream()) {\n            GoogleCredentials credentials = GoogleCredentials.fromStream(inputStream);\n            FirebaseOptions firebaseOptions = FirebaseOptions.builder()\n                .setCredentials(credentials)\n                .build();\n\n            if (FirebaseApp.getApps().isEmpty()) {\n                FirebaseApp.initializeApp(firebaseOptions);\n                log.info(\"======= Firebase init start =======\");\n            }\n\n            return FirebaseMessaging.getInstance();\n        } catch (IOException e) {\n            log.error(\"======= firebase moabam error =======\\n\" + e);\n            throw new FcmException(ErrorMessage.FAILED_FCM_INIT);\n        }\n    }\n}</code></pre></div>\n<p><strong>2) 콕 찌르기 알림 기능 구현 코드 중 일부분</strong></p>\n<ul>\n<li>방 참여자들은 다른 참여자들에게 12시간마다 1회의 콕 찌르기 알림을 보낼 수 있다는 요구사항을 지키기 위해</li>\n</ul>\n<p><code class=\"language-text\">Redis</code> 저장소를 활용했습니다.</p>\n<ul>\n<li>콕 찌르기 알림은 사용자들의 중요한 정보라거나, 보안적으로 문제되는 정보라고 생각하지 않았기 때문에,</li>\n</ul>\n<p><code class=\"language-text\">FirebaseMessaging</code>의 <code class=\"language-text\">sendAsync()</code>를 활용했습니다. 즉, <code class=\"language-text\">Firebase</code> 서버로 비동기 요청을 하여 성능을 챙겼습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@Transactional\npublic void sendKnockNotification(MemberTest member, Long targetId, Long roomId) {\n    String knockKey = generateKnockKey(member.memberId(), targetId, roomId);\n    validateConflictKnockNotification(knockKey);\n    validateFcmToken(targetId);\n\n    Notification notification = NotificationMapper.toKnockNotificationEntity(member.nickname());\n    sendAsyncFcm(targetId, notification);\n    notificationRepository.saveKnockNotification(knockKey);\n}\n\nprivate void sendAsyncFcm(Long fcmTokenKey, Notification notification) {\n    String fcmToken = notificationRepository.findFcmTokenByMemberId(fcmTokenKey);\n    Message message = NotificationMapper.toMessageEntity(notification, fcmToken);\n\n    firebaseMessaging.sendAsync(message);\n}\n\n\nprivate void validateConflictKnockNotification(String knockKey) {\n    if (notificationRepository.existsByKey(knockKey)) {\n        throw new ConflictException(ErrorMessage.CONFLICT_KNOCK);\n    }\n}\n\nprivate void validateFcmToken(Long memberId) {\n    if (!notificationRepository.existsFcmTokenByMemberId(memberId)) {\n        throw new NotFoundException(ErrorMessage.NOT_FOUND_FCM_TOKEN);\n    }\n}\n\nprivate String generateKnockKey(Long memberId, Long targetId, Long roomId) {\n    return requireNonNull(roomId) + UNDER_BAR + requireNonNull(memberId) + TO + requireNonNull(targetId);\n}</code></pre></div>\n<p><strong>3) 인증 타임에 따른 알림 중 일부분</strong></p>\n<ul>\n<li>방 내의 루틴 인증 시작 타임이 된다면 방 참여자들에게 알림이 간다. 라는 요구사항을 지키기 위해 스케줄러를 활용했습니다.</li>\n<li>성능을 위해 병렬 스트림을 활용했습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/**\n * CRON_CERTIFY_TIME_EXPRESSION : \"0 50 * * * *\";\n * ONE : 1\n * HOURS_IN_A_DAY : 24\n */\n@Scheduled(cron = CRON_CERTIFY_TIME_EXPRESSION)\npublic void sendCertificationTimeNotification() {\n    int certificationTime = (LocalDateTime.now().getHour() + ONE) % HOURS_IN_A_DAY;\n    List&lt;Participant> participants = participantSearchRepository.findAllByRoomCertifyTime(certificationTime);\n\n    participants.parallelStream().forEach(participant -> {\n        String roomTitle = participant.getRoom().getTitle();\n        Notification notification = NotificationMapper.toCertifyAuthNotificationEntity(roomTitle);\n        sendAsyncFcm(participant.getMemberId(), notification);\n    });\n}\n\nprivate void sendAsyncFcm(Long fcmTokenKey, Notification notification) {\n    String fcmToken = notificationRepository.findFcmTokenByMemberId(fcmTokenKey);\n    Message message = NotificationMapper.toMessageEntity(notification, fcmToken);\n\n    firebaseMessaging.sendAsync(message);\n}</code></pre></div>\n<hr>\n<h2 id=\"병렬-스트림과-반복문-성능-비교\" style=\"position:relative;\"><a href=\"#%EB%B3%91%EB%A0%AC-%EC%8A%A4%ED%8A%B8%EB%A6%BC%EA%B3%BC-%EB%B0%98%EB%B3%B5%EB%AC%B8-%EC%84%B1%EB%8A%A5-%EB%B9%84%EA%B5%90\" aria-label=\"병렬 스트림과 반복문 성능 비교 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병렬 스트림과 반복문 성능 비교</h2>\n<h3 id=\"배경\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EA%B2%BD\" aria-label=\"배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배경</h3>\n<p>현재 모아밤 서비스의 요구사항에 따른 인증 타임 알림 서비스는 레이스 컨디션이 발생해도 문제가 발생하지 않는 로직입니다. 또한 사용자가 늘어나면 늘어날수록 반복이 배로 늘어나게 됩니다. 때문에 병렬 스트림을 쓰는 것에 대해 고민을 하게 되었습니다.</p>\n<h3 id=\"고민-사항\" style=\"position:relative;\"><a href=\"#%EA%B3%A0%EB%AF%BC-%EC%82%AC%ED%95%AD\" aria-label=\"고민 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>고민 사항</h3>\n<ul>\n<li>현재 로직만 봤을 때, 반복문 내에서 지연되는 부분이 없는 데 병렬 처리가 단순 반복문보다 성능이 좋을까요?</li>\n<li><code class=\"language-text\">Stream</code>의 내부적으로 동작하는 박싱, 언박싱을 고려했을 때, 병렬 처리가 단순 반복문보다 성능이 좋을까요?</li>\n</ul>\n<p>고민사항을 토대로 어떻게 결론을 내릴까 하다가, <strong>백문이 불여일견</strong>처럼 직접 테스트를 해보고 결론을 내리도록 했습니다.</p>\n<h3 id=\"성능-테스트\" style=\"position:relative;\"><a href=\"#%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"성능 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>성능 테스트</h3>\n<p><strong>1) <code class=\"language-text\">Firebase</code>의 <code class=\"language-text\">sendAsync</code> 요청 시간 : 5ms</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 626px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.444444444444445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI1z2NWQ6DMAxEOVFpSmgoNJCFJIRFvf9pphp/8PFk2Rq/adpPj1gq0nbAxYy17AhpQ8wVZb9kJ9ZFmX4tWEKSDG/1/ElOaQOlBzQPozFZL4LROuR6SpAPhEVkmr0IWUohJd8l3CXP7o1XP+APYIlG76Jp//0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm7.png\"\n        title=\"fcm7.png\"\n        src=\"/static/9945d39d544310da59d196f0e9d5708e/af590/fcm7.png\"\n        srcset=\"/static/9945d39d544310da59d196f0e9d5708e/e9ff0/fcm7.png 180w,\n/static/9945d39d544310da59d196f0e9d5708e/f21e7/fcm7.png 360w,\n/static/9945d39d544310da59d196f0e9d5708e/af590/fcm7.png 626w\"\n        sizes=\"(max-width: 626px) 100vw, 626px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2) 임의 리스트 생성 후 테스트 성능 : 100_000 (십만)</strong></p>\n<ul>\n<li>일반 반복문이 너무 오래 걸려 중단했습니다. 그 정도로 큰 차이가 났습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhElEQVQI1zVPWw6DMAzjPhPQd0tXBC2Mst3/PkbJlA/LcewoyfBSGvXq2NuFenTEvGLSDsoGzMYzpBbWLnItmPTfG5XDQOZxf3H2H7b24bCLGTYsDNHGJ/j0Zk0sGfG0S7xsGJVFPW+UrSGvOwd8KjxEoKGwFO7T9aSJqUc+MS2ZTeDPHm9qYni4AvdvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm8.png\"\n        title=\"fcm8.png\"\n        src=\"/static/d2164f4884655ef7779d95030c254cec/37523/fcm8.png\"\n        srcset=\"/static/d2164f4884655ef7779d95030c254cec/e9ff0/fcm8.png 180w,\n/static/d2164f4884655ef7779d95030c254cec/f21e7/fcm8.png 360w,\n/static/d2164f4884655ef7779d95030c254cec/37523/fcm8.png 720w,\n/static/d2164f4884655ef7779d95030c254cec/302a4/fcm8.png 1080w,\n/static/d2164f4884655ef7779d95030c254cec/1dbe8/fcm8.png 1374w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2) 임의 리스트 생성 후 테스트 성능 : 10_000 (일만)</strong></p>\n<ul>\n<li>약 7~8배 차이로 병렬 처리가 더 좋았습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnklEQVQY032Q3QqDMAxGfZsNR622Te3PtM453YS9/+N8o5WKeLGLQ75ASA4pwvQCtR5cEmqpUbIal5Lheqv+cpyJmdUSgiwKToRxfmNZv3hMC4wPkNqCjIdq3U7sjxjfp6rtHdp2aVlaKKzBc/5gWla4bkiWZ7ggNKpN+VxzrhqFRhkUTEi4fkAY5/1qvhxfkU03k41smO1iFmTAhcYPGM+B+rTSRHsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm9.png\"\n        title=\"fcm9.png\"\n        src=\"/static/243274bb8866c35ba7fb0f20b1d30184/37523/fcm9.png\"\n        srcset=\"/static/243274bb8866c35ba7fb0f20b1d30184/e9ff0/fcm9.png 180w,\n/static/243274bb8866c35ba7fb0f20b1d30184/f21e7/fcm9.png 360w,\n/static/243274bb8866c35ba7fb0f20b1d30184/37523/fcm9.png 720w,\n/static/243274bb8866c35ba7fb0f20b1d30184/302a4/fcm9.png 1080w,\n/static/243274bb8866c35ba7fb0f20b1d30184/21482/fcm9.png 1350w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3) 임의 리스트 생성 후 테스트 성능 : 1_000 (천)</strong></p>\n<ul>\n<li>약 6배 차이로 병렬 처리가 더 좋았습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.555555555555555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAgUlEQVQI112O7QqDMAxF+zobqNW26afVyWRjsPd/nDuSYRF/hJPcpIeqe68R64Jl21EfT6R5RT9adNo0nvszj+J5mBy0ISgWUil4fb7Y9jdCrphcgHER1icYijK7kBs5u3K0Xvbq1g3QRCLjH7KQj1hGsbQHPs2SMTk77v55FiHXDxHqYiU/pSYWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm10.png\"\n        title=\"fcm10.png\"\n        src=\"/static/726d15988da0807fc7be88ce9685ae05/37523/fcm10.png\"\n        srcset=\"/static/726d15988da0807fc7be88ce9685ae05/e9ff0/fcm10.png 180w,\n/static/726d15988da0807fc7be88ce9685ae05/f21e7/fcm10.png 360w,\n/static/726d15988da0807fc7be88ce9685ae05/37523/fcm10.png 720w,\n/static/726d15988da0807fc7be88ce9685ae05/302a4/fcm10.png 1080w,\n/static/726d15988da0807fc7be88ce9685ae05/6569d/fcm10.png 1328w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4) 임의 리스트 생성 후 테스트 성능 : 100 (백)</strong></p>\n<ul>\n<li>드디어 단순 반복문 성능이 더 좋네요. 즉 값이 적을 때는 단순 반복문이 더 빠른 것 같습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAkklEQVQY05WOSw7CIABEuY32Qyl/EDWtWrXR+19nzOBON7p4mWQY4AlpLMo0w4YMZTxGG7Dthp/ZtBKtHKFdwqAdRNMrmJSwrA9c1ycO0xk+Fbi4q8mPSMj7muw+YT/aCGUCRCMVbM6YLzeclnsd0FS7WKExocE74xfs+RjvVcNOafhckMqxDv4x5I5nxif0yuAFm7WA5/Cq4JgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fcm11.png\"\n        title=\"fcm11.png\"\n        src=\"/static/f85817b687fa9f0d128e489c6f6b0901/37523/fcm11.png\"\n        srcset=\"/static/f85817b687fa9f0d128e489c6f6b0901/e9ff0/fcm11.png 180w,\n/static/f85817b687fa9f0d128e489c6f6b0901/f21e7/fcm11.png 360w,\n/static/f85817b687fa9f0d128e489c6f6b0901/37523/fcm11.png 720w,\n/static/f85817b687fa9f0d128e489c6f6b0901/302a4/fcm11.png 1080w,\n/static/f85817b687fa9f0d128e489c6f6b0901/b5a09/fcm11.png 1360w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h3>\n<p>테스트를 통해 사용자가 많아지면 많아질수록 병렬처리가 더 좋다는 결과를 도출했기 때문에 병렬 처리로 결론을 내렸습니다. 감사합니다.</p>\n<hr>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://velog.io/@heelieben/FCM-React-Web-Push-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-feat.-pwa-service-worker\">React + FCM 구현하기</a></li>\n<li><a href=\"https://seungwoolog.tistory.com/88\">FCM 도입 시 고려해야 할 사항</a></li>\n<li><a href=\"https://firebase.google.com/docs/cloud-messaging/manage-tokens?hl=ko\">FCM 등록 토큰 관리 모범 사례 - 공식문서</a></li>\n<li><a href=\"https://zuminternet.github.io/FCM-PUSH/\">FCM 푸시 파헤치기 - ZUM Internet Tech</a></li>\n</ul>","frontmatter":{"date":"November 07, 2023","title":"모아밤의 FCM Push 알림 도입기","categories":"Tech","author":"홍혁준","emoji":"🧑🏻‍💻"},"fields":{"slug":"/firebase-push-notification/"}},"site":{"siteMetadata":{"siteUrl":"https://team-moabam.github.io","comments":{"utterances":{"repo":"team-moabam/team-moabam.github.io"}}}}},"pageContext":{"slug":"/embedded-redis/","nextSlug":"","prevSlug":"/firebase-push-notification/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}